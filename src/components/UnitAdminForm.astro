---
import type { UnitForm } from "@/form/UnitForm";
import Field from "@/components/Field.astro";

interface Props {
  csrfToken: string;
  unitForm: UnitForm;
  submitLabel: string;
}

const { csrfToken, unitForm, submitLabel } = Astro.props;
const fields = unitForm.getFields();
const errors = unitForm.getErrors();
---

{errors.form && <p class="admin-form__error" role="alert">{errors.form}</p>}

<form method="POST" class="admin-form">
  <input type="hidden" name="_csrf" value={csrfToken} />

  {fields.map((field) => (
    <Field field={field} error={errors[field.name]} />
  ))}

  <div class="field">
    <label for="description" class="field__label">Description</label>
    <textarea
      id="description"
      name="description"
      rows="4"
      class="field__textarea"
      aria-describedby={errors.description ? "description-error" : undefined}
    >{unitForm.getValue("description") ?? ""}</textarea>
    {errors.description && (
      <p id="description-error" class="field__error">{errors.description}</p>
    )}
  </div>

  <div class="field">
    <label for="keywords" class="field__label">Keywords</label>
    <input
      id="keywords"
      name="keywords"
      class="field__input"
      value={unitForm.getValue("keywords") ?? ""}
      placeholder="e.g. Infantry, Imperium, Adeptus Astartes"
      aria-describedby={errors.keywords ? "keywords-error" : undefined}
    />
    {errors.keywords && (
      <p id="keywords-error" class="field__error">{errors.keywords}</p>
    )}
  </div>

  <button type="submit" class="admin-form__submit" formnovalidate>{submitLabel}</button>
</form>
